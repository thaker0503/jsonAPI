<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.1.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.js"></script> -->
    <title>To Do | Using API</title>
    <!-- <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js" integrity="sha512-57oZ/vW8ANMjR/KQ6Be9v/+/h6bq9/l3f0Oc7vn6qMqyhvPd1cvKBRWWpzu0QoneImqr2SkmO4MSqU+RpHom3Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/themes/base/jquery-ui.css" integrity="sha512-lCk0aEL6CvAGQvaZ47hoq1v/hNsunE8wD4xmmBelkJjg51DauW6uVdaWEJlwgAE6PxcY7/SThs1T4+IMwwpN7w==" crossorigin="anonymous" referrerpolicy="no-referrer" />


    <style>
        /* body{
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 500px;
        }
        #container{
            width: 50%;
        } */
        
        .todo-item{
            list-style-type: none;
        }
        .error{
            color: red;
            position: absolute;
            top: 4px;
        
        }

    </style>
</head>
<body>
    <form >
        <div class="error">* All values are mandatory</div>
        <input type="text" placeholder="Enter Task Title" id="title">
        <input type="text" placeholder="Enter Task description" id="description">
        <!-- <input type="text" placeholder="Enter Time to be completed" id="endTime"> -->
        <button id="addTask">Add Task</button>
    </form>
    <button id="btn">Add New Task</button>
    <div id="container">
        <h2>Todo List</h2>
        <!-- <div id="todoList">
            <ul id="todo">
                <li><a href="#yesterday">Yesterday</a></li>
                <li><a href="#today">Today</a></li>
                <li><a href="#tomorrow">Tomorrow</a></li>
            </ul>
            <ol id="yesterday">
                <li><input type="checkbox">Task 1</li>
                <li><input type="checkbox">Task 2</li>
            </ol>
            <ol id="today">
                <li><input type="checkbox">Task 3</li>
                <li><input type="checkbox">Task 4</li>
            </ol>
            <ol id="tomorrow">
                <li><input type="checkbox">Task 5</li>
                <li><input type="checkbox">Task 6</li>
            </ol>
        </div> -->
        <ul id="todos">
            <div class="pending">
                <h1>Pending Tasks</h1>
            </div>
            <div class="completed">
                <h1>Completed Tasks</h1>
            </div>
        </ul>
    </div>

    <!-- <button onclick="notifyMe()">Notify me!</button> -->




    <script>
        const user = "yatharth"
        const url = `https://internapp.vercel.app/${user}/todos/`  
        
        function trueValue(final){
            console.log("True Value")
            $.ajax({
                        url: final,
                        type: 'PUT',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            completed: true
                        }),
                        success:
                            function (data) {
                                console.log("Success")
                                console.log(data)
                                window.location.reload()
                            }
                    })
        }

        function falseValue(final){
            console.log("False" )
            $.ajax({
                url: final,
                type: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify({
                    completed: false
                }),
                success:
                    function (data) {
                        console.log("Success")
                        console.log(data)
                        window.location.reload()
                    }


            })
        }
        
        
        function checkBoxClick(id) {
                // console.log("Function Called")
                // console.log(url + id)
                const final = url + id
                var param
                $.get({
                    url : url + id,
                    success: function(data){
                        console.log(data)
                        // param = data
                        // console.log(param.title)
                        // console.log(param.description)
                        // console.log(param.id)
                        console.log(data.completed)
                        data.completed ? falseValue(final) : trueValue(final)
                    }
                })
                // var params = {
                    
                // }
                // if(!param.completed){
                        
                // }else{
                    
                }
                
            
        
            function del(id){
                console.log("Function Called")
                console.log(url + id)
                const final = url + id
                $.ajax({
                    url: final,
                    type: 'DELETE',
                    success: function (data) {
                        console.log(data)
                        window.location.reload();
                    }
                })
            }
            
            


        $(function(){
            $(".error").hide()
            // $(`<a href='${url}'>Link</a>`).appendTo("#todo")
            $("form").css({
                display : "flex",
                flexDirection : "column",
                justifyContent : "space-evenly",
                fontSize : "24px",
                alignItems : "center",
                // padding : "10px 20px"
            }).dialog({
                autoOpen : false,
                 title: "Add Task",
                 width : '380' ,
                 height : '280'
            })
            $("#btn").click(function(){
               $("form").dialog("open"); 
            })
            $("#todoList").tabs({
                active: 1
            });
            $("ol").sortable({axis : "y", containment:'#todoList'})

            

            $.get(url, function (data) {
                if(data == '' || data == null){
                    $("<p>Add new task...</p>").appendTo(".pending")
                    $("<p>Add new task...</p>").appendTo(".completed")
                }else{
                    $.each(data, function (i, item) {
                        console.log(item.completed)
                        if (item.completed) {
                            $("<p>No tasks pending...</p>").appendTo(".pending")
                            $(`<li class="todo-item"><input id='checkBox' type='checkbox' onclick="checkBoxClick('${item.id}')" checked/> Title: ${item.title} <br> Description: ${item.description}<br><button id="${item.id}" onclick="del('${item.id}')"">Delete</button></li><br>`).appendTo(".completed")
                        } else {
                            $("<p>Complete your pending tasks</p>").appendTo(".completed")
                            $(`<li class="todo-item"><input id='checkBox' type='checkbox' onclick="checkBoxClick('${item.id}')"/> Title: ${item.title} <br> Description: ${item.description}<br><button id="${item.id}" onclick="del('${item.id}')"">Delete</button></li><br>`).appendTo(".pending")
                        }
                    })
                }
            })

            

            $("#addTask").click(function (e) {
                e.preventDefault();
                let product = {
                    title: $("#title").val(),
                    description: $("#description").val(),
                    completed: false
                };
                console.log(product);
                var newProduct = JSON.stringify(product);
                if (product.title != "" && product.description != "") {
                    $.ajax({
                        url: url,
                        type: "POST",
                        data: newProduct,
                        contentType: "application/json",
                        success: function (data) {
                            console.log(data);
                            $("form").dialog("close"); 
                            window.location.reload()
                            // $("ul").append(`<li>Name: ${data.name},<br/>Price: ${data.price},<br/>Description: ${data.desc}<br/><button>Edit</button></li><br/>`);
                        }
                    });
                } else {
                    // alert("Enter Values")
                    $(".error").show("slow")
                }
            }).css({
                width : '50%',
                cursor : 'pointer'

            })

            
            // $("input[type=checkbox]").prop(":checked",function(){

            // })
            
        })

        










        // function notifyMe() {
        //         if (!("Notification" in window)) {
        //             alert("This browser does not support desktop notification");
        //         } else if (Notification.permission !== "denied") {
        //             Notification.requestPermission().then((permission) => {
        //                 if (permission === "granted") {
        //                     const notification = new Notification("Hi there!");
        //                 }
        //             });
        //         }
        //     }

    </script>
</body>
</html>